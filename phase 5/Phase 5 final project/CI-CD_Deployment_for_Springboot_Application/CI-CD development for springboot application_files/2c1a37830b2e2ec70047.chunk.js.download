(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{2409:function(e,t,n){window,e.exports=function(){return n={},e.m=t=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.9.0",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",CURRENCY_CODE:"currencyCode",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",ACTION_DEFINITIONS:"actionDefinitions",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",NEWSFEED_MESSAGES:"newsfeedMessages",MESSAGE_ID:"messageId",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",SYNC_INBOX:"syncNewsfeed",MESSAGES:"messages",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_DEFINITIONS:"actionDefinitions",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_DEFINITIONS:"__leanplum_action_definitions",INBOX_MESSAGES:"__leanplum_inbox_messages",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",SESSION:"__leanplum_session",MESSAGE_OCCURRENCES:"__leanplum_message_occurrences",MESSAGE_CACHE:"__leanplum_message_cache",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)",DEFAULT_PUSH_ACTION:"Open action"}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(0)),i=(o.prototype.add=function(e,t){return void 0===t?this:(this.argString&&(this.argString+="&"),n=t instanceof Array?JSON.stringify(t):encodeURIComponent(t),this.argString+=e+"="+n,this.argValues[e]=t,this);var n},o.prototype.body=function(e){return e?(this._body=e,this):this._body},o.prototype.attachApiKeys=function(e,t){return this.add(s.default.PARAMS.APP_ID,e).add(s.default.PARAMS.CLIENT,s.default.CLIENT).add(s.default.PARAMS.CLIENT_KEY,t)},o.prototype.build=function(){return this.argString},o.prototype.buildDict=function(){return this.argValues},o);function o(){this.argString="",this.argValues={}}t.default=i},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var s={},i=(o.getFromLocalStorage=function(e){return!1===r?s[e]:localStorage[e]},o.saveToLocalStorage=function(e,t){if(!1!==r)try{localStorage[e]=t}catch(n){r=!1,s[e]=t}else s[e]=t},o.removeFromLocalStorage=function(e){if(!1!==r)try{localStorage.removeItem(e)}catch(t){r=!1,delete s[e]}else delete s[e]},o);function o(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.setNetworkTimeout=function(e){this.networkTimeoutSeconds=e},s.prototype.ajax=function(e,t,n,r,s,i,o){var a=this;if(i){if(this.runningRequest)return this.enqueueRequest(arguments);this.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),this.ajaxIE8(e,t,n,r,s,i,o);var u=!1,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState){if(u)return;var e,t=!(u=!0);if(o)e=c.responseText;else try{e=JSON.parse(c.responseText)}catch(e){setTimeout(function(){s&&s(null,c)},0),t=!0}t||(200<=c.status&&c.status<300?setTimeout(function(){r&&r(e,c)},0):setTimeout(function(){s&&s(e,c)},0)),i&&(a.runningRequest=!1,a.dequeueRequest())}},c.open(e,t,!0),c.setRequestHeader("Content-Type","text/plain"),c.send(n),setTimeout(function(){u||c.abort()},1e3*this.networkTimeoutSeconds)},s.prototype.ajaxIE8=function(e,t,n,r,s,i,o){var a=this,u=new XDomainRequest;u.onload=function(){var e,t=!1;if(o)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){s&&s(null,u)},0),t=!0}t||setTimeout(function(){r&&r(e,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onerror=u.ontimeout=function(){setTimeout(function(){s&&s(null,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onprogress=function(){},u.open(e,t),u.timeout=1e3*this.networkTimeoutSeconds,u.send(n)},s.prototype.enqueueRequest=function(e){this.requestQueue.push(e)},s.prototype.dequeueRequest=function(){var e=this.requestQueue.shift();e&&this.ajax.apply(this,e)},s);function s(){this.networkTimeoutSeconds=10,this.requestQueue=[],this.runningRequest=!1}t.default=r},function(e,t,n){(function(e,n){var r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",u="[object Array]",c="[object AsyncFunction]",l="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",h="[object GeneratorFunction]",v="[object Map]",g="[object Number]",_="[object Null]",S="[object Object]",y="[object Promise]",b="[object Proxy]",A="[object RegExp]",m="[object Set]",E="[object String]",I="[object Symbol]",R="[object Undefined]",T="[object WeakMap]",M="[object ArrayBuffer]",O="[object DataView]",w=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[a]=N[u]=N[M]=N[l]=N[O]=N[d]=N[f]=N[p]=N[v]=N[g]=N[S]=N[A]=N[m]=N[E]=N[T]=!1;var C="object"==typeof e&&e&&e.Object===Object&&e,P="object"==typeof self&&self&&self.Object===Object&&self,k=C||P||Function("return this")(),U=t&&!t.nodeType&&t,L=U&&"object"==typeof n&&n&&!n.nodeType&&n,V=L&&L.exports===U,F=V&&C.process,j=function(){try{return F&&F.binding&&F.binding("util")}catch(e){}}(),q=j&&j.isTypedArray;function H(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return 1}function K(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function W(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var x,Y,B,G=Array.prototype,J=Function.prototype,z=Object.prototype,X=k["__core-js_shared__"],$=J.toString,Q=z.hasOwnProperty,Z=(x=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",ee=z.toString,te=RegExp("^"+$.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=V?k.Buffer:void 0,re=k.Symbol,se=k.Uint8Array,ie=z.propertyIsEnumerable,oe=G.splice,ae=re?re.toStringTag:void 0,ue=Object.getOwnPropertySymbols,ce=ne?ne.isBuffer:void 0,le=(Y=Object.keys,B=Object,function(e){return Y(B(e))}),de=Fe(k,"DataView"),fe=Fe(k,"Map"),pe=Fe(k,"Promise"),he=Fe(k,"Set"),ve=Fe(k,"WeakMap"),ge=Fe(Object,"create"),_e=Ke(de),Se=Ke(fe),ye=Ke(pe),be=Ke(he),Ae=Ke(ve),me=re?re.prototype:void 0,Ee=me?me.valueOf:void 0;function Ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Me(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Te;++t<n;)this.add(e[t])}function Oe(e){var t=this.__data__=new Re(e);this.size=t.size}function we(e,t){var n=Ye(e),r=!n&&xe(e),s=!n&&!r&&Be(e),i=!n&&!r&&!s&&Qe(e),o=n||r||s||i,a=o?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=a.length;for(var c in e)!t&&!Q.call(e,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||He(c,u))||a.push(c);return a}function De(e,t){for(var n=e.length;n--;)if(We(e[n][0],t))return n;return-1}function Ne(e){return null==e?void 0===e?R:_:ae&&ae in Object(e)?function(e){var t=Q.call(e,ae),n=e[ae];try{var r=!(e[ae]=void 0)}catch(e){}var s=ee.call(e);return r&&(t?e[ae]=n:delete e[ae]),s}(e):(t=e,ee.call(t));var t}function Ce(e){return Xe(e)&&Ne(e)==a}function Pe(e,t,n,r,o){return e===t||(null==e||null==t||!Xe(e)&&!Xe(t)?e!=e&&t!=t:function(e,t,n,r,o,c){var p=Ye(e),h=Ye(t),_=p?u:qe(e),y=h?u:qe(t),b=(_=_==a?S:_)==S,R=(y=y==a?S:y)==S,T=_==y;if(T&&Be(e)){if(!Be(t))return!1;b=!(p=!0)}if(T&&!b)return c=c||new Oe,p||Qe(e)?Ue(e,t,n,r,o,c):function(e,t,n,r,o,a,u){switch(n){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case M:return!(e.byteLength!=t.byteLength||!a(new se(e),new se(t)));case l:case d:case g:return We(+e,+t);case f:return e.name==t.name&&e.message==t.message;case A:case E:return e==t+"";case v:var c=K;case m:var p=r&s;if(c=c||W,e.size!=t.size&&!p)return!1;var h=u.get(e);if(h)return h==t;r|=i,u.set(e,t);var _=Ue(c(e),c(t),r,o,a,u);return u.delete(e),_;case I:if(Ee)return Ee.call(e)==Ee.call(t)}return!1}(e,t,_,n,r,o,c);if(!(n&s)){var w=b&&Q.call(e,"__wrapped__"),D=R&&Q.call(t,"__wrapped__");if(w||D)return o(w?e.value():e,D?t.value():t,n,r,c=c||new Oe)}return T&&function(e,t,n,r,i,o){var a=n&s,u=Le(e),c=u.length;if(c!=Le(t).length&&!a)return!1;for(var l=c;l--;){var d=u[l];if(!(a?d in t:Q.call(t,d)))return!1}var f=o.get(e);if(f&&o.get(t))return f==t;var p=!0;o.set(e,t),o.set(t,e);for(var h=a;++l<c;){var v=e[d=u[l]],g=t[d];if(r)var _=a?r(g,v,d,t,e,o):r(v,g,d,e,t,o);if(!(void 0===_?v===g||i(v,g,n,r,o):_)){p=!1;break}h=h||"constructor"==d}if(p&&!h){var S=e.constructor,y=t.constructor;S!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof S&&S instanceof S&&"function"==typeof y&&y instanceof y)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,o,c=c||new Oe)}(e,t,n,r,Pe,o))}function ke(e){if(n=(t=e)&&t.constructor,t!==("function"==typeof n&&n.prototype||z))return le(e);var t,n,r=[];for(var s in Object(e))Q.call(e,s)&&"constructor"!=s&&r.push(s);return r}function Ue(e,t,n,r,o,a){var u=n&s,c=e.length,l=t.length;if(c!=l&&!(u&&c<l))return!1;var d=a.get(e);if(d&&a.get(t))return d==t;var f=-1,p=!0,h=n&i?new Me:void 0;for(a.set(e,t),a.set(t,e);++f<c;){var v=e[f],g=t[f];if(r)var _=u?r(g,v,f,t,e,a):r(v,g,f,e,t,a);if(void 0!==_){if(_)continue;p=!1;break}if(h){if(!H(t,function(e,t){return s=t,!h.has(s)&&(v===e||o(v,e,n,r,a))&&h.push(t);var s})){p=!1;break}}else if(v!==g&&!o(v,g,n,r,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function Le(e){return function(e,t,n){var r=t(e);return Ye(e)?r:function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}(r,n(e))}(e,Ze,je)}function Ve(e,t){var n,r,s=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function Fe(e,t){var n,r=null==(n=e)?void 0:n[t];return function(e){return ze(e)&&!(Z&&Z in e)&&(Ge(e)?te:w).test(Ke(e))}(r)?r:void 0}Ie.prototype.clear=function(){this.__data__=ge?ge(null):{},this.size=0},Ie.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ie.prototype.get=function(e){var t=this.__data__;if(ge){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},Ie.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:Q.call(t,e)},Ie.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ge&&void 0===t?r:t,this},Re.prototype.clear=function(){this.__data__=[],this.size=0},Re.prototype.delete=function(e){var t=this.__data__,n=De(t,e);return!(n<0||(n==t.length-1?t.pop():oe.call(t,n,1),--this.size,0))},Re.prototype.get=function(e){var t=this.__data__,n=De(t,e);return n<0?void 0:t[n][1]},Re.prototype.has=function(e){return-1<De(this.__data__,e)},Re.prototype.set=function(e,t){var n=this.__data__,r=De(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Te.prototype.clear=function(){this.size=0,this.__data__={hash:new Ie,map:new(fe||Re),string:new Ie}},Te.prototype.delete=function(e){var t=Ve(this,e).delete(e);return this.size-=t?1:0,t},Te.prototype.get=function(e){return Ve(this,e).get(e)},Te.prototype.has=function(e){return Ve(this,e).has(e)},Te.prototype.set=function(e,t){var n=Ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Me.prototype.add=Me.prototype.push=function(e){return this.__data__.set(e,r),this},Me.prototype.has=function(e){return this.__data__.has(e)},Oe.prototype.clear=function(){this.__data__=new Re,this.size=0},Oe.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Oe.prototype.get=function(e){return this.__data__.get(e)},Oe.prototype.has=function(e){return this.__data__.has(e)},Oe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Re){var r=n.__data__;if(!fe||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Te(r)}return n.set(e,t),this.size=n.size,this};var je=ue?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o)&&(i[s++]=o)}return i}(ue(e),function(t){return ie.call(e,t)}))}:function(){return[]},qe=Ne;function He(e,t){return(t=null==t?o:t)&&("number"==typeof e||D.test(e))&&-1<e&&e%1==0&&e<t}function Ke(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(de&&qe(new de(new ArrayBuffer(1)))!=O||fe&&qe(new fe)!=v||pe&&qe(pe.resolve())!=y||he&&qe(new he)!=m||ve&&qe(new ve)!=T)&&(qe=function(e){var t=Ne(e),n=t==S?e.constructor:void 0,r=n?Ke(n):"";if(r)switch(r){case _e:return O;case Se:return v;case ye:return y;case be:return m;case Ae:return T}return t});var xe=Ce(function(){return arguments}())?Ce:function(e){return Xe(e)&&Q.call(e,"callee")&&!ie.call(e,"callee")},Ye=Array.isArray,Be=ce||function(){return!1};function Ge(e){if(ze(e)){var t=Ne(e);return t==p||t==h||t==c||t==b}}function Je(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=o}function ze(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Xe(e){return null!=e&&"object"==typeof e}var $e,Qe=q?($e=q,function(e){return $e(e)}):function(e){return Xe(e)&&Je(e.length)&&!!N[Ne(e)]};function Ze(e){return(null!=(t=e)&&Je(t.length)&&!Ge(t)?we:ke)(e);var t}n.exports=function(e,t){return Pe(e,t)}}).call(this,n(14),n(15)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.decodeColor=function(e){var t=255&e,n=255&(e>>=8);return"rgba("+(255&(e>>=8))+","+n+","+t+","+(255&(e>>=8))/255+")"},s.encodeColor=function(e){if("number"==typeof e)return e;var t=/^rgba\((\d+),(\d+),(\d+),(\d+(\.\d+)?)\)$/.exec(e);if(t)return(255*parseInt(t[4],10)<<24)+((255&parseInt(t[1],10))<<16)+((255&parseInt(t[2],10))<<8)+(255&parseInt(t[3],10));var n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e);if(n)return(255<<24)+((255&parseInt(n[1],16))<<16)+((255&parseInt(n[2],16))<<8)+(255&parseInt(n[3],16));throw new Error('Could not parse color "'+e+'"')},s);function s(){}t.default=r},function(e,t,n){var r=n(7);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(0)),i=r(n(8)),o=(a.setApiPath=function(e){a._lp.setApiPath(e)},a.setEmail=function(){},a.setNetworkTimeout=function(e){a._lp.setNetworkTimeout(e)},a.setAppIdForDevelopmentMode=function(e,t){a._lp.setAppIdForDevelopmentMode(e,t)},a.setAppIdForProductionMode=function(e,t){a._lp.setAppIdForProductionMode(e,t)},a.setSocketHost=function(e){a._lp.setSocketHost(e)},a.setDeviceId=function(e){a._lp.setDeviceId(e)},a.setLocale=function(e){a._lp.setLocale(e)},a.setAppVersion=function(e){a._lp.setAppVersion(e)},a.setDeviceName=function(e){a._lp.setDeviceName(e)},a.setDeviceModel=function(e){a._lp.setDeviceModel(e)},a.setRequestBatching=function(e,t){a._lp.setRequestBatching(e,t)},a.setSystemName=function(e){a._lp.setSystemName(e)},a.setSystemVersion=function(e){a._lp.setSystemVersion(e)},a.setVariables=function(e){a._lp.setVariables(e)},a.setVariantDebugInfoEnabled=function(e){a._lp.setVariantDebugInfoEnabled(e)},a.enableRichInAppMessages=function(e){a._lp.enableRichInAppMessages(e)},a.processMessageEvent=function(e,t){a._lp.processMessageEvent(e,t)},a.getVariantDebugInfo=function(){return a._lp.getVariantDebugInfo()},a.getVariables=function(){return a._lp.getVariables()},a.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=a._lp).getVariable.apply(e,t)},a.getVariants=function(){return a._lp.getVariants()},a.inbox=function(){return a._lp.inbox()},a.addStartResponseHandler=function(e){a._lp.addStartResponseHandler(e)},a.removeStartResponseHandler=function(e){a._lp.removeStartResponseHandler(e)},a.addVariablesChangedHandler=function(e){a._lp.addVariablesChangedHandler(e)},a.removeVariablesChangedHandler=function(e){a._lp.removeVariablesChangedHandler(e)},a.forceContentUpdate=function(e){a._lp.forceContentUpdate(e)},a.useSessionLength=function(e){a._lp.useSessionLength(e)},a.start=function(e,t,n){a._lp.start(e,t,n)},a.startFromCache=function(e,t,n){a._lp.startFromCache(e,t,n)},a.stop=function(){a._lp.stop()},a.pauseSession=function(){a._lp.pauseSession()},a.resumeSession=function(){a._lp.resumeSession()},a.pauseState=function(){a._lp.pauseState()},a.resumeState=function(){a._lp.resumeState()},a.getUserId=function(){return this._lp.getUserId()},a.setUserId=function(e){a.setUserAttributes(e)},a.setUserAttributes=function(e,t){a._lp.setUserAttributes(e,t)},a.track=function(e,t,n,r){a._lp.track(e,t,n,r)},a.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase"),a._lp.trackPurchase(e,t,n,r)},a.advanceTo=function(e,t,n){a._lp.advanceTo(e,t,n)},a.isWebPushSupported=function(){return a._lp.isWebPushSupported()},a.isWebPushSubscribed=function(){return a._lp.isWebPushSubscribed()},a.setWebPushOptions=function(e){return a._lp.setWebPushOptions(e)},a.registerForWebPush=function(e){return a._lp.registerForWebPush(e)},a.unregisterFromWebPush=function(){return a._lp.unregisterFromWebPush()},a.clearUserContent=function(){a._lp.clearUserContent()},a.defineAction=function(e){a._lp.defineAction(e)},a.applyQueue=function(e){a._lp.applyQueue(e)},a.on=function(e,t){a._lp.on(e,t)},a.off=function(e,t){a._lp.off(e,t)},a.getFileUrl=function(e){return a._lp.getFileUrl(e)},a.__destroy=function(){this._lp=new i.default(window)},a._lp=new i.default(window),a.VERSION=s.default.SDK_VERSION,a);function a(){}t.default=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),o=s(n(9)),a=s(n(0)),u=s(n(10)),c=s(n(11)),l=s(n(12)),d=s(n(13)),f=s(n(2)),p=s(n(17)),h=s(n(18)),v=s(n(19)),g=n(20),_=s(n(21)),S=a.default.DEFAULT_KEYS.SESSION,y=(b.prototype.setApiPath=function(e){this._lpRequest.apiPath&&(this._lpRequest.apiPath=e)},b.prototype.setNetworkTimeout=function(e){this._lpRequest.setNetworkTimeout(e),this._lpSocket.setNetworkTimeout(e)},b.prototype.setAppIdForDevelopmentMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!0},b.prototype.setAppIdForProductionMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!1},b.prototype.setSocketHost=function(e){this._lpSocket.setSocketHost(e)},b.prototype.setDeviceId=function(e){this._lpRequest.deviceId=e},b.prototype.setLocale=function(e){this._locale=e},b.prototype.setAppVersion=function(e){this._lpRequest.versionName=e},b.prototype.setDeviceName=function(e){this._deviceName=e},b.prototype.setDeviceModel=function(e){this._deviceModel=e},b.prototype.setRequestBatching=function(e,t){this._lpRequest.batchEnabled=e,this._lpRequest.batchCooldown=t},b.prototype.setSystemName=function(e){this._systemName=e},b.prototype.setSystemVersion=function(e){this._systemVersion=e},b.prototype.setVariables=function(e){this._varCache.setVariables(e)},b.prototype.setVariantDebugInfoEnabled=function(e){this._internalState.variantDebugInfoEnabled=e},b.prototype.enableRichInAppMessages=function(e){this._messages.enableRichInAppMessages(e)},b.prototype.processMessageEvent=function(e,t){this._messages.processMessageEvent(e,t)},b.prototype.getVariantDebugInfo=function(){return this._varCache.getVariantDebugInfo()},b.prototype.getVariables=function(){return this._varCache.getVariables()},b.prototype.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._varCache).getVariable.apply(e,t)},b.prototype.getVariants=function(){return this._varCache.variants||[]},b.prototype.inbox=function(){return this._lpInbox},b.prototype.on=function(e,t){this._events.on(e,t)},b.prototype.off=function(e,t){this._events.off(e,t)},b.prototype.onInboxAction=function(e,t){var n=this;this._messages.trackMessage(e,{event:"Open"},function(){return t&&n._messages.onAction(t)})},b.prototype.defineAction=function(e){this._varCache.registerActionDefinition(r({kind:g.MessageKind.Template},e))},b.prototype.addStartResponseHandler=function(e){this._internalState.addStartResponseHandler(e)},b.prototype.removeStartResponseHandler=function(e){this._internalState.removeStartResponseHandler(e)},b.prototype.addVariablesChangedHandler=function(e){this._varCache.addVariablesChangedHandler(e)},b.prototype.removeVariablesChangedHandler=function(e){this._varCache.removeVariablesChangedHandler(e)},b.prototype.getFileUrl=function(e){return this._lpRequest.getFileUrl(e)},b.prototype.forceContentUpdate=function(e){var t=this,n=(new i.default).add(a.default.PARAMS.INCLUDE_DEFAULTS,!1).add(a.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(a.default.METHODS.GET_VARS,n,{queued:!1,sendNow:!0,response:function(n){var r=t._lpRequest.getLastResponse(n),s=t._lpRequest.isResponseSuccess(r);s&&(t._varCache.applyDiffs(r[a.default.KEYS.VARS],r[a.default.KEYS.VARIANTS],r[a.default.KEYS.ACTION_DEFINITIONS]),t._varCache.setVariantDebugInfo(r[a.default.KEYS.VARIANT_DEBUG_INFO]),t._events.emit("messagesReceived",r[a.default.KEYS.MESSAGES])),e&&e(s)}})},b.prototype.useSessionLength=function(e){this._sessionLength=e},b.prototype.start=function(e,t,n){var r=this;if("function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.hasActiveSession()&&!this._internalState.devMode)return this.startFromCache(e,t,n);this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._varCache.onUpdate=function(){r._varCache.triggerVariablesChangedHandlers()};var s=(new i.default).add(a.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(a.default.PARAMS.COUNTRY,a.default.VALUES.DETECT).add(a.default.PARAMS.REGION,a.default.VALUES.DETECT).add(a.default.PARAMS.CITY,a.default.VALUES.DETECT).add(a.default.PARAMS.LOCATION,a.default.VALUES.DETECT).add(a.default.PARAMS.SYSTEM_NAME,this._systemName||this._browserDetector.OS).add(a.default.PARAMS.SYSTEM_VERSION,(this._systemVersion||"").toString()).add(a.default.PARAMS.BROWSER_NAME,this._browserDetector.browser).add(a.default.PARAMS.BROWSER_VERSION,this._browserDetector.version.toString()).add(a.default.PARAMS.LOCALE,this._locale||a.default.VALUES.DETECT).add(a.default.PARAMS.DEVICE_NAME,this._deviceName||this._browserDetector.browser+" "+this._browserDetector.version).add(a.default.PARAMS.DEVICE_MODEL,this._deviceModel||"Web Browser").add(a.default.PARAMS.NEWSFEED_MESSAGES,this._lpInbox.messageIds()).add(a.default.PARAMS.INCLUDE_DEFAULTS,!1).add(a.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(a.default.METHODS.START,s,{queued:!0,sendNow:!0,response:function(e){r._internalState.hasStarted=!0;var t=r._lpRequest.getLastResponse(e),n=r._lpRequest.isResponseSuccess(t);if(r._internalState.startSuccessful=n){r.updateSession();var s=t[a.default.KEYS.MESSAGES];if(t.actionDefinitions&&(s.actionDefinitions=t.actionDefinitions),r._events.emit("messagesReceived",s),t[a.default.KEYS.SYNC_INBOX]&&r._lpInbox.downloadMessages(),r._internalState.devMode){var i=t[a.default.KEYS.LATEST_VERSION];i&&console.log("A newer version of the Leanplum SDK, "+i+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),r.connectSocket()}r._varCache.applyDiffs(t[a.default.KEYS.VARS],t[a.default.KEYS.VARIANTS],t[a.default.KEYS.ACTION_DEFINITIONS]),r._varCache.setVariantDebugInfo(t[a.default.KEYS.VARIANT_DEBUG_INFO]),r._varCache.token=t[a.default.KEYS.TOKEN]}else r._varCache.loadDiffs();r._events.emit("start",{success:n}),r._internalState.triggerStartHandlers()}})},b.prototype.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.updateSession(),this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._internalState.hasStarted=!0,this._internalState.startSuccessful=!0,this._internalState.devMode&&this.connectSocket(),this._varCache.loadDiffs(),this._events.emit("resume"),this._internalState.triggerStartHandlers()},b.prototype.stop=function(){this.createRequest(a.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0,response:function(){f.default.removeFromLocalStorage(S)}})},b.prototype.pauseSession=function(){this.createRequest(a.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},b.prototype.resumeSession=function(){this._events.emit("resume"),this.createRequest(a.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},b.prototype.pauseState=function(){this.createRequest(a.default.METHODS.PAUSE_STATE,void 0,{queued:!0})},b.prototype.resumeState=function(){this.createRequest(a.default.METHODS.RESUME_STATE,void 0,{queued:!0})},b.prototype.getUserId=function(){return this._lpRequest.userId},b.prototype.setUserId=function(e){this.setUserAttributes(e)},b.prototype.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new i.default).add(a.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(a.default.PARAMS.NEW_USER_ID,e);this._events.emit("setUserAttribute",t),this.createRequest(a.default.METHODS.SET_USER_ATTRIBUTES,n,{queued:!0}),e&&(this._lpRequest.userId=e,f.default.saveToLocalStorage(a.default.DEFAULT_KEYS.USER_ID,this._lpRequest.userId))},b.prototype.track=function(e,t,n,r){var s=this;"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var o=(new i.default).add(a.default.PARAMS.EVENT,e).add(a.default.PARAMS.VALUE,t||0).add(a.default.PARAMS.INFO,n).add(a.default.PARAMS.PARAMS,JSON.stringify(r));this._events.emit("track",{eventName:e,params:r}),this.createRequest(a.default.METHODS.TRACK,o,{queued:!0,response:function(){return s.updateSession()}})},b.prototype.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase");var s=(new i.default).add(a.default.PARAMS.EVENT,r).add(a.default.PARAMS.VALUE,e||0).add(a.default.PARAMS.PARAMS,JSON.stringify(n));t&&s.add(a.default.PARAMS.CURRENCY_CODE,t),this._events.emit("track",{eventName:r}),this.createRequest(a.default.METHODS.TRACK,s,{queued:!0})},b.prototype.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new i.default).add(a.default.PARAMS.STATE,e).add(a.default.PARAMS.INFO,t).add(a.default.PARAMS.PARAMS,JSON.stringify(n));this._events.emit("advanceState",{state:e,params:n}),this.createRequest(a.default.METHODS.ADVANCE,r,{queued:!0})},b.prototype.isWebPushSupported=function(){return this._pushManager.isWebPushSupported()},b.prototype.isWebPushSubscribed=function(){return this._pushManager.isWebPushSubscribed()},b.prototype.setWebPushOptions=function(e){this._webPushOptions=r({},e)},b.prototype.registerForWebPush=function(e){var t=this;if(this._pushManager.isWebPushSupported()){var n=this._webPushOptions||{},r=e||n.serviceWorkerUrl,s=n&&n.scope?{scope:n.scope}:null;return this._pushManager.register(r,s,function(e){return e?Promise.resolve(!0):t._pushManager.subscribeUser()})}return Promise.reject("Leanplum: WebPush is not supported.")},b.prototype.unregisterFromWebPush=function(){return this._pushManager.unsubscribeUser()},b.prototype.clearUserContent=function(){this._varCache.clearUserContent()},b.prototype.applyQueue=function(e){var t=this;e.forEach(function(e){return t[e.name].apply(t,e.args)})},b.prototype.createRequest=function(e,t,n){void 0===n&&(n={}),this._lpRequest.request(e,t,r({devMode:this._internalState.devMode},n))},b.prototype.connectSocket=function(){this._lpSocket.connect({appId:this._lpRequest.appId,deviceId:this._lpRequest.deviceId})},b.prototype.hasActiveSession=function(){if(!this._sessionLength)return!1;var e=Date.now(),t=parseInt(f.default.getFromLocalStorage(S));return!isNaN(t)&&e-t<1e3*this._sessionLength},b.prototype.updateSession=function(){f.default.saveToLocalStorage(S,String(Date.now()))},b);function b(e){var t=this;this.wnd=e,this._events=new v.default,this._internalState=new u.default,this._lpInbox=new c.default(this.createRequest.bind(this),this.onInboxAction.bind(this)),this._lpRequest=new l.default,this._varCache=new _.default(this.createRequest.bind(this)),this._lpSocket=new d.default(this._varCache,this.createRequest.bind(this),this._lpRequest.getLastResponse.bind(this._lpRequest),this._events),this._pushManager=new p.default(this.createRequest.bind(this)),this._messages=new h.default(this._events,this.createRequest.bind(this),this.getFileUrl.bind(this)),this._browserDetector=new o.default(e),this._events.on("navigationChange",function(e){var n=!1;t._events.emit("openUrl",{preventDefault:function(){return n=!0},url:e}),n||t.wnd.location.assign(e)}),this._events.on("registerForPush",function(){return t.registerForWebPush()})}t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},s.prototype.searchVersion=function(e){if(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))}},s.prototype.getBrowserData=function(e){return[{string:e.navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.navigator.userAgent,subString:"OmniWeb",identity:"OmniWeb",versionSearch:"OmniWeb/"},{string:e.navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:e.navigator.vendor,subString:"iCab",identity:"iCab"},{string:e.navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:e.navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.navigator.vendor,subString:"Camino",identity:"Camino"},{string:e.navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:e.navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.navigator.userAgent,subString:"Android",identity:"Android Browser",versionSearch:"Version"},{string:e.navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:e.navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]},s.prototype.getOSData=function(e){return[{string:e.navigator.platform,subString:"Win",identity:"Windows"},{string:e.navigator.platform,subString:"Mac",identity:"Mac OS"},{string:e.navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:e.navigator.userAgent,subString:"Android",identity:"Android"},{string:e.navigator.platform,subString:"Linux",identity:"Linux"}]},s);function s(e){this.browser=this.searchString(this.getBrowserData(e))||"Unknown Browser",this.version=this.searchVersion(e.navigator.userAgent)||this.searchVersion(e.navigator.appVersion)||"Unknown Version",this.OS=this.searchString(this.getOSData(e))||"Unknown OS"}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.addStartResponseHandler=function(e){this.startHandlers.push(e),this.hasStarted&&e(this.startSuccessful)},s.prototype.removeStartResponseHandler=function(e){var t=this.startHandlers.indexOf(e);0<=t&&this.startHandlers.splice(t,1)},s.prototype.triggerStartHandlers=function(){for(var e=0;e<this.startHandlers.length;e++)this.startHandlers[e](this.startSuccessful)},s);function s(){this.startHandlers=[],this.devMode=!1,this.hasStarted=!1,this.startSuccessful=!1,this.variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};function i(e){return Object.keys(e).map(function(t){return e[t]})}Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(1)),a=s(n(0)),u=(c.prototype.downloadMessages=function(){var e=this;this.createRequest("getNewsfeedMessages",void 0,{queued:!0,sendNow:!0,response:function(t){var n=null==t?void 0:t.response[0];n&&n.newsfeedMessages&&(e.messageMap=n.newsfeedMessages,e.triggerChangeHandlers())}})},c.prototype.markAsRead=function(e){var t=this.messageMap[e];if(t&&!t.isRead){t.isRead=!0,this.triggerChangeHandlers();var n=new o.default;n.add("newsfeedMessageId",e),this.createRequest("markNewsfeedMessageAsRead",n,{})}},c.prototype.read=function(e){this.markAsRead(e);var t=this.message(e),n=e.split("##")[0],r=(null==t?void 0:t.openAction())||null;this.onAction(n,r)},c.prototype.remove=function(e){if(this.messageMap[e]){delete this.messageMap[e],this.triggerChangeHandlers();var t=new o.default;t.add("newsfeedMessageId",e),this.createRequest("deleteNewsfeedMessage",t,{})}},c.prototype.onChanged=function(e){this.changeHandlers.push(e)},c.prototype.triggerChangeHandlers=function(){this.changeHandlers.forEach(function(e){return e()}),this.save()},c.prototype.save=function(){sessionStorage.setItem(a.default.DEFAULT_KEYS.INBOX_MESSAGES,JSON.stringify(this.messageMap))},c.prototype.load=function(){var e=sessionStorage.getItem(a.default.DEFAULT_KEYS.INBOX_MESSAGES);this.messageMap=JSON.parse(e)||{}},c.prototype.count=function(){return i(this.messageMap).length},c.prototype.unreadCount=function(){return i(this.messageMap).filter(function(e){return!e.isRead}).length},c.prototype.messages=function(e){var t=[];for(var n in this.messageMap){var r=this.messageMap[n];e(r)&&t.push(l.create(n,r))}return t},c.prototype.allMessages=function(){return this.messages(function(){return!0})},c.prototype.unreadMessages=function(){return this.messages(function(e){return!e.isRead})},c.prototype.messageIds=function(){return Object.keys(this.messageMap)},c.prototype.message=function(e){var t=this.messageMap[e];return t?l.create(e,t):null},c);function c(e,t){this.createRequest=e,this.onAction=t,this.messageMap={},this.changeHandlers=[],this.load()}t.default=u;var l=(d.create=function(e,t){var n,s,i,o,u,c,l,f,p,h,v,g=null===(n=t.messageData)||void 0===n?void 0:n.parentCampaignId,_=r(r({},null===(i=null===(s=t.messageData)||void 0===s?void 0:s.vars)||void 0===i?void 0:i[a.default.VALUES.DEFAULT_PUSH_ACTION]),{parentCampaignId:g});return new d(e,null===(u=null===(o=t.messageData)||void 0===o?void 0:o.vars)||void 0===u?void 0:u.Title,null===(l=null===(c=t.messageData)||void 0===c?void 0:c.vars)||void 0===l?void 0:l.Subtitle,null===(p=null===(f=t.messageData)||void 0===f?void 0:f.vars)||void 0===p?void 0:p.Data,t.deliveryTimestamp,t.isRead,null===(v=null===(h=t.messageData)||void 0===h?void 0:h.vars)||void 0===v?void 0:v.Image,_)},d.prototype.id=function(){return this._id},d.prototype.title=function(){return this._title},d.prototype.subtitle=function(){return this._subtitle},d.prototype.data=function(){return this._data},d.prototype.timestamp=function(){return this._timestamp},d.prototype.isRead=function(){return this._isRead},d.prototype.imageUrl=function(){return this._imageUrl},d.prototype.openAction=function(){return this._openAction},d);function d(e,t,n,r,s,i,o,a){this._id=e,this._title=t,this._subtitle=n,this._data=r,this._timestamp=s,this._isRead=i,this._imageUrl=o,this._openAction=a}t.LeanplumInboxMessage=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(1)),i=r(n(0)),o=r(n(2)),a=r(n(3)),u=(Object.defineProperty(c.prototype,"userId",{get:function(){var e,t;return null!==(t=null!==(e=this.userIdValue)&&void 0!==e?e:this.loadLocal(i.default.DEFAULT_KEYS.USER_ID))&&void 0!==t?t:this.deviceId},set:function(e){this.userIdValue=e},enumerable:!0,configurable:!0}),c.prototype.request=function(e,t,n){var r=this;if(void 0===n&&(n={}),n=n||{},t=t||new s.default,this.deviceId||(this.deviceId=this.loadLocal(i.default.DEFAULT_KEYS.DEVICE_ID)),!this.deviceId){for(var o="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",u=0;u<16;u++)o+=a.charAt(Math.floor(Math.random()*a.length));this.deviceId=o,this.saveLocal(i.default.DEFAULT_KEYS.DEVICE_ID,o)}this.saveLocal(i.default.DEFAULT_KEYS.USER_ID,this.userId);var c=t.attachApiKeys(this.appId,this.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.DEVICE_ID,this.deviceId).add(i.default.PARAMS.USER_ID,this.userId).add(i.default.PARAMS.ACTION,e).add(i.default.PARAMS.VERSION_NAME,this.versionName).add(i.default.PARAMS.DEV_MODE,n.devMode).add(i.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),l=n.success||n.response,d=n.error||n.response;if(!this.appId||!this.clientKey){var f="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(f),void(d&&d(f))}if(t.body())this.network.ajax("POST",this.apiPath+"?"+c.build(),t.body(),l,d,n.queued);else{var p=n.devMode||n.sendNow||!this.batchEnabled,h=function(){var e=r.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),o=(new s.default).attachApiKeys(r.appId,r.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.ACTION,i.default.METHODS.MULTI).add(i.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();r.network.ajax("POST",r.apiPath+"?"+o,t,l,d,n.queued)}};if(!p&&this.batchCooldown){var v=(new Date).getTime()/1e3;!this.lastRequestTime||v-this.lastRequestTime>=this.batchCooldown?(p=!0,this.lastRequestTime=v):this.cooldownTimeout||(this.cooldownTimeout=setTimeout(function(){r.cooldownTimeout=null,r.lastRequestTime=(new Date).getTime()/1e3,h()},1e3*(this.batchCooldown-(v-this.lastRequestTime))))}this.saveRequestForLater(c.buildDict()),p&&h()}},c.prototype.getFileUrl=function(e){if(!e)return"";if(/^https?:/.test(e))return e;var t=(new s.default).attachApiKeys(this.appId,this.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.ACTION,"downloadFile").add("filename",e);return this.apiPath+"?"+t.build()},c.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},c.prototype.getLastResponse=function(e){var t,n,r,s=null!==(n=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.length)&&void 0!==n?n:0;return 0<s?null===(r=null==e?void 0:e.response)||void 0===r?void 0:r[s-1]:null},c.prototype.isResponseSuccess=function(e){return Boolean(null==e?void 0:e.success)},c.prototype.saveRequestForLater=function(e){var t=this.loadLocal(i.default.DEFAULT_KEYS.COUNT)||0,n=i.default.DEFAULT_KEYS.ITEM+t;this.saveLocal(n,JSON.stringify(e)),t++,this.saveLocal(i.default.DEFAULT_KEYS.COUNT,t)},c.prototype.popUnsentRequests=function(){var e=[],t=this.loadLocal(i.default.DEFAULT_KEYS.COUNT)||0;this.removeLocal(i.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=i.default.DEFAULT_KEYS.ITEM+n;try{e.push(JSON.parse(this.loadLocal(r)))}catch(e){}this.removeLocal(r)}return e},c.prototype.loadLocal=function(e){return o.default.getFromLocalStorage(e)},c.prototype.saveLocal=function(e,t){o.default.saveToLocalStorage(e,t)},c.prototype.removeLocal=function(e){o.default.removeFromLocalStorage(e)},c);function c(e){void 0===e&&(e=new a.default),this.network=e,this.cooldownTimeout=null,this.lastRequestTime=void 0,this.userIdValue=void 0,this.apiPath="https://api.leanplum.com/api",this.batchCooldown=5,this.batchEnabled=!0}t.default=u},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(4)),i=r(n(1)),o=r(n(0)),a=r(n(16)),u=(c.prototype.connect=function(e){var t=this;if(WebSocket){var n=!1;this.socketClient=new a.default,this.socketClient.setNetworkTimeout(this.networkTimeoutSeconds),this.socketClient.onopen=function(){var r;n||(console.log("Leanplum: Connected to development server."),t.socketClient.send("auth",((r={})[o.default.PARAMS.APP_ID]=e.appId,r[o.default.PARAMS.DEVICE_ID]=e.deviceId,r)),n=!0)},this.socketClient.onerror=function(e){console.log("Leanplum: Socket error",e)},this.socketClient.onmessage=this.onMessageReceived.bind(this),this.socketClient.onclose=function(){console.log("Leanplum: Disconnected from development server."),n=!1},this.socketClient.connect(this.socketHost),setInterval(function(){t.socketClient.connected||t.socketClient.connecting||t.socketClient.connect(t.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},c.prototype.setSocketHost=function(e){this.socketHost=e},c.prototype.setNetworkTimeout=function(e){var t;this.networkTimeoutSeconds=e,null!==(t=this.socketClient)&&void 0!==t&&t.setNetworkTimeout(e)},c.prototype.onMessageReceived=function(e,t){var n=this;if("updateVars"===e){var r=(new i.default).add(o.default.PARAMS.INCLUDE_DEFAULTS,!1);this.createRequest(o.default.METHODS.GET_VARS,r,{queued:!1,sendNow:!0,response:function(e){var t=n.getLastResponse(e),r=t[o.default.KEYS.VARS],i=t[o.default.KEYS.VARIANTS],a=t[o.default.KEYS.ACTION_DEFINITIONS];s.default(r,n.cache.diffs)||n.cache.applyDiffs(r,i,a)}})}else if("getVariables"===e)this.cache.sendVariables(),this.socketClient.send("getContentResponse",{updated:!0});else if("getActions"===e){var a=this.cache.sendActions();this.socketClient.send("getContentResponse",{updated:a})}else if("registerDevice"===e){var u=t[0];alert("Your device has been registered to "+u.email+".")}else"trigger"===e&&(u=t[0],this.events.emit("previewRequest",u))},c);function c(e,t,n,r){this.cache=e,this.createRequest=t,this.getLastResponse=n,this.events=r,this.networkTimeoutSeconds=10,this.socketClient=null,this.socketHost="dev.leanplum.com"}t.default=u},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(3)),i=(o.prototype.connect=function(e){var t=this;this.connecting=!0,this.network.ajax("POST","https://"+e+"/socket.io/1","",function(n){var r=n.split(":"),s=r[0],i=parseInt(r[1])/2*1e3;t.socket=new WebSocket("wss://"+e+"/socket.io/1/websocket/"+s);var o=null;t.socket.onopen=function(){t.connected=!0,t.connecting=!1,t.onopen&&t.onopen(),o=setInterval(function(){t.socket.send("2:::")},i)},t.socket.onclose=function(){t.connected=!1,clearInterval(o),t.onclose&&t.onclose()},t.socket.onmessage=function(e){var n=e.data.split(":"),r=parseInt(n[0]);if(2===r)t.socket.send("2::");else if(5===r){var s=n[1],i=JSON.parse(n.slice(3).join(":")),o=i.name,a=i.args;s&&t.socket.send("6:::"+s),t.onmessage&&t.onmessage(o,a)}else 7===r&&console.log("Socket error: "+e.data)},t.socket.onerror=function(e){t.socket.close(),t.onerror&&t.onerror(e)}},null,!1,!0)},o.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},o.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},o);function o(){this.network=new s.default,this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(n(1)),a=i(n(0)),u=i(n(2)),c=(Object.defineProperty(l.prototype,"serviceWorker",{get:function(){return window.navigator.serviceWorker},enumerable:!0,configurable:!0}),l.prototype.isWebPushSupported=function(){return Boolean(void 0!==(null===window||void 0===window?void 0:window.navigator)&&"serviceWorker"in window.navigator&&"PushManager"in window)},l.prototype.isWebPushSubscribed=function(){return r(this,void 0,void 0,function(){var e,t,n;return s(this,function(r){switch(r.label){case 0:return this.isWebPushSupported()?[4,this.getServiceWorkerRegistration()]:[2,!1];case 1:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[2,!1];case 2:return t=r.sent(),(n=null!==t)&&this.updateNewSubscriptionOnServer(t),[2,n]}})})},l.prototype.register=function(e,t,n){return r(this,void 0,void 0,function(){var r,i,o,a;return s(this,function(s){switch(s.label){case 0:if(!this.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),[2,n(!1)];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,(r=this).serviceWorker.register(e||"/sw.min.js",t)];case 2:return r.serviceWorkerRegistration=s.sent(),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:return i=s.sent(),(o=null!==i)&&this.updateNewSubscriptionOnServer(i),[2,n(o)];case 4:return a=s.sent(),console.log("Leanplum: Service Worker Error: ",a),[2,n(!1)];case 5:return[2]}})})},l.prototype.subscribeUser=function(){return r(this,void 0,void 0,function(){var e,t,n;return s(this,function(r){switch(r.label){case 0:e=this.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})];case 2:if(!(t=r.sent()))throw new Error;return this.updateNewSubscriptionOnServer(t),[3,4];case 3:throw n=r.sent(),new Error("Leanplum: Failed to subscribe the user: "+n);case 4:return[2,!0]}})})},l.prototype.unsubscribeUser=function(){return r(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,this.isWebPushSubscribed()];case 1:if(!n.sent())return[3,6];n.label=2;case 2:return n.trys.push([2,5,,6]),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:if(!(e=n.sent()))throw new Error;return[4,e.unsubscribe()];case 4:return n.sent(),[3,6];case 5:throw t=n.sent(),new Error("Leanplum: Error unsubscribing: "+t);case 6:return[2]}})})},l.prototype.getServiceWorkerRegistration=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.serviceWorkerRegistration?[3,2]:[4,(e=this).serviceWorker.getRegistration()];case 1:e.serviceWorkerRegistration=t.sent(),t.label=2;case 2:return[2,this.serviceWorkerRegistration]}})})},l.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=this.decodeData(t),r=new Uint8Array(n.length),s=0;s<n.length;++s)r[s]=n.charCodeAt(s);return r},l.prototype.updateNewSubscriptionOnServer=function(e){if(e){var t=this.prepareSubscription(e),n=JSON.stringify(t);u.default.getFromLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION)!==n&&(u.default.saveToLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),this.setSubscription(n))}},l.prototype.prepareSubscription=function(e){var t="getKey"in e?e.getKey("p256dh"):[],n="getKey"in e?e.getKey("auth"):[],r=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(t))),s=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(n)));return{endpoint:e.endpoint,key:r,auth:s}},l.prototype.setSubscription=function(e){if(e){var t=(new o.default).add(a.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);this.createRequest(a.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{queued:!1,sendNow:!0})}},l.prototype.encodeData=function(e){return window.btoa(e)},l.prototype.decodeData=function(e){return window.atob(e)},l);function l(e){this.createRequest=e,this.serviceWorkerRegistration=null}t.default=c},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(0)),o=s(n(1)),a=s(n(3)),u=s(n(4)),c=s(n(2)),l=s(n(5)),d=(f.prototype.recordOccurrence=function(e){var t=(this.session[e]||0)+1;this.session[e]=t;var n=this.occurrences[e]||[];n.push(Date.now()),this.occurrences[e]=n,this.save()},f.prototype.recordTriggerOccurrence=function(e){var t=this.triggers[e]||[];return t.push(Date.now()),this.triggers[e]=t,this.save(),t.length},f.prototype.getSessionOccurranceCount=function(e){return this.session[e]||0},f.prototype.getOccurrences=function(e){return this.occurrences[e]||[]},f.prototype.clearSession=function(){this.session={}},f.prototype.load=function(){var e=c.default.getFromLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_OCCURRENCES);if(e){var t=JSON.parse(e);this.session=t.session,this.triggers=t.triggers,this.occurrences=t.occurrences}},f.prototype.save=function(){var e=i.default.DEFAULT_KEYS.MESSAGE_OCCURRENCES;c.default.saveToLocalStorage(e,JSON.stringify({session:this.session,triggers:this.triggers,occurrences:this.occurrences}))},f);function f(){this.session={},this.triggers={},this.occurrences={}}var p=(h.prototype.enableRichInAppMessages=function(e){this._showRichIAM=e},h.prototype.onTrigger=function(e){var t=this,n=this.getMessages();Object.keys(n).filter(function(r){return t.shouldShowMessage(r,n[r],e)}).slice(0,1).forEach(function(e){return t.showMessage(e,n[e])})},h.prototype.onMessagePreview=function(e){var t=e.action,n={track:function(t){var n=t?"event '"+t+"'":"impression";console.log("Tracking "+n+" for "+e.messageId)},runActionNamed:function(e){return console.log("Running untracked action '"+e+"'")},runTrackedActionNamed:function(e){return console.log("Running tracked action '"+e+"'")}};this.handleMessage({isPreview:!0,message:this.addDefaults(r({messageId:e.messageId},t)),context:n})},h.prototype.onMessagesReceived=function(e){var t=e||{};this._messageCache=t,c.default.saveToLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_CACHE,JSON.stringify(t))},h.prototype.shouldShowMessage=function(e,t,n){var r=Date.now(),s=this.matchesTrigger(t.whenTriggers,n),i=this.matchesTrigger(t.unlessTriggers,n);if(!s||i)return!1;var o=this.occurrenceTracker.recordTriggerOccurrence(e);return!(!this.matchesLimits(e,t.whenLimits,o)||t.startTime&&t.endTime&&(r<t.startTime||t.endTime<r))},h.prototype.showMessage=function(e,t){var n=this,s=this.addDefaults(r({},t.vars)),i={track:function(t,r,s,i){n.occurrenceTracker.recordOccurrence(e),n.trackMessage(e,{event:t,value:r,info:s,params:i})},runActionNamed:function(t){return n.onAction(s[t],e)},runTrackedActionNamed:function(t){var r=t.replace(/ action$/,"");n.trackMessage(e,{event:r},function(){return n.onAction(s[t],e)})}};this.handleMessage({context:i,message:r({messageId:e},s)})},h.prototype.processMessageEvent=function(e,t){var n=document.getElementById("lp-message-"+e);if(n){var r=t.replace(/^http:\/\/leanplum\//,"").split("?"),s=r[0],i=r[1],o=(void 0===i?"":i).split("&").reduce(function(e,t){var n=t.split("="),r=n[0],s=n[1];return e[r]=decodeURIComponent(s),e},{}),a=n.metadata,u=a.message,c=a.context;switch(s){case"loadFinished":if(n.style.visibility="visible",n.style.left="0",0<u["HTML Height"]){var l=u["HTML Width"];n.style.height=u["HTML Height"]+"px",n.style.width=l,n.style.left="calc((100% - "+l+") / 2)";var d=u["HTML Align"].toLowerCase(),f="top"===d?"bottom":"top";n.style[d]="0",n.style[f]=""}else n.style.top="0";c.track();break;case"track":c.track(o.event,parseFloat(o.value),o.parameters,o.info);break;case"runAction":case"runTrackedAction":c[s+"Named"](o.action);case"close":n.metadata=null,n.parentNode.removeChild(n)}}else console.log("message closed, skipping event processing")},h.prototype.handleMessage=function(e){var t=this;if(this._showRichIAM&&"HTML"===e.message.__name__){this.resolveFiles(e.message);var n=e.message.Template||"";(new a.default).ajax("get",n.replace("-10.html","-11.html"),"",function(n){return t.renderRichInAppMessage(n,e)},function(){},!1,!0)}else this.events.emit("showMessage",this.resolveFields(e))},h.prototype.renderRichInAppMessage=function(e,t){var n=t.message.messageId,r=JSON.stringify(t.message),s=document.createElement("iframe");s.setAttribute("id","lp-message-"+n),s.style.cssText=["border-width: 0","position: fixed","top: -100%","left: -100%","width: 100%","height: 100%","visibility: hidden","z-index: 100000"].join(";"),document.body.appendChild(s),s.metadata=t,s.contentWindow.messageId=n;var i=e.replace("##Vars##",r).replace("<body>","<body><script>window.messageId='"+n+"'<\/script>");if("srcdoc"in s)s.srcdoc=i;else{var o=s.contentWindow.document;o.open(),o.write(i),o.close()}},h.prototype.trackMessage=function(e,t,n){function r(e){return void 0!==e}void 0===t&&(t={event:null}),void 0===n&&(n=function(){});var s=(new o.default).add(i.default.PARAMS.MESSAGE_ID,e);t.event&&s.add(i.default.PARAMS.EVENT,t.event),r(t.value)&&s.add(i.default.PARAMS.VALUE,t.value||0),r(t.info)&&s.add(i.default.PARAMS.INFO,t.info),r(t.params)&&s.add(i.default.PARAMS.PARAMS,JSON.stringify(t.params)),this.createRequest(i.default.METHODS.TRACK,s,{queued:!0,sendNow:!0,response:n})},h.prototype.onAction=function(e,t){var n=this;if(void 0===t&&(t=""),e){var r=this._messageCache;if("Chain to Existing Message"!==e.__name__){var s=function(){var r=e.__name__;"Open URL"===e.__name__?n.events.emit("navigationChange",e.URL):"Register For Push"===e.__name__?n.events.emit("registerForPush"):r&&n.showMessage(t,{messageId:t,action:r,vars:e})},i=this.messageIdFromAction(e);i?this.trackMessage(i,{event:null},s):s()}else{var o=e["Chained message"],a=r[o];"Open URL"===a.action?this.trackMessage(o,{event:"View"},function(){return n.onAction(a.vars,o)}):"Register For Push"===a.action?this.events.emit("registerForPush"):this.showMessage(o,a)}}},h.prototype.getMessages=function(){return this._messageCache||{}},h.prototype.addDefaults=function(e){var t=this,n=(this.getMessages().actionDefinitions||{})[e.__name__],s=null==n?void 0:n.kinds;if(!n)return e;var i=function(e,n,r){void 0===r&&(r="");for(var o=0,a=Object.keys(n);o<a.length;o++){var u=a[o],c=n[u];"object"==typeof c?e[u]=i(e[u]||{},c,""+r+u+"."):void 0===e[u]&&(e[u]=c),"FILE"===s[""+r+u]&&(e[u]=t.getFileUrl(e[u]))}return e};return i(r({},e),n.values)},h.prototype.resolveFiles=function(e){var t=/^__file__/;for(var n in e)t.test(n)?e[n.replace(t,"")]=this.getFileUrl(e[n]):"object"==typeof e[n]&&(e[n]=this.resolveFiles(e[n]));return e},h.prototype.resolveFields=function(e){var t=/\bcolor/i,n=/^__file__/;for(var r in e)n.test(r)?e[r.replace(n,"")+" URL"]=this.getFileUrl(e[r]):t.test(r)?e[r]=l.default.decodeColor(e[r]):"object"==typeof e[r]&&(e[r]=this.resolveFields(e[r]));return e},h.prototype.messageIdFromAction=function(e){var t=this._messageCache,n=r({},e);delete n.parentCampaignId;for(var s=0,i=Object.keys(t);s<i.length;s++){var o=i[s],a=t[o];if(a.parentCampaignId===e.parentCampaignId&&u.default(a.vars,n))return o}},h.prototype.matchesTrigger=function(e,t){if(!e)return!1;function n(e,t){return 0===e.toString().localeCompare(t.toString(),void 0,{sensitivity:"accent"})}function r(e,t,r){var s=e===r.noun;if("triggers"===r.verb)return s;if("triggersWithParameter"===r.verb){var i=r.objects,o=i[0],a=i[1],u=o in t&&n(a,t[o]);return s&&u}}return e.children.some(function(e){var s=e.subject;switch(t.trigger){case"start":return"start"===s||"resume"===s;case"resume":return"resume"===s;case"event":return"event"===s&&r(t.eventName,t.params,e);case"userAttribute":if("userAttribute"!==s)return!1;var i=e.noun in t.attributes;if("changes"===e.verb)return i;if("changesTo"!==e.verb)break;if(!i)return!1;var o=t.attributes[e.noun];return e.objects.some(function(e){return null===e&&null===o||e&&o&&n(e,o)});case"state":return"state"===s&&r(t.state,t.params,e)}return!1})},h.prototype.matchesLimits=function(e,t,n){var r=this;return!t||t.children.every(function(t){var s=t.subject,i=t.verb,o=parseInt(t.noun.toString());if("times"!==s)return"onNthOccurrence"===s?n===o:"everyNthOccurrence"===s&&n%o==0;if("limitSession"===i)return r.occurrenceTracker.getSessionOccurranceCount(e)+1===o;if("limitUser"===i)return(a=r.occurrenceTracker.getOccurrences(e).length)+1<=o;var a,u=parseInt(t.objects[0].toString())||1,c=function(e){switch(i){case"limitSecond":return 1e3;case"limitMinute":return 6e4;case"limitHour":return 36e5;case"limitDay":return 864e5}}()*u,l=(a=r.occurrenceTracker.getOccurrences(e)).length;return l<o||a.slice(l-o,l)[0]<Date.now()-c})},h);function h(e,t,n){var r=this;this.events=e,this.createRequest=t,this.getFileUrl=n,this._messageCache={},this.occurrenceTracker=new d,this._showRichIAM=!1,e.on("previewRequest",this.onMessagePreview.bind(this)),e.on("messagesReceived",this.onMessagesReceived.bind(this)),e.on("start",function(){r.occurrenceTracker.load(),r.occurrenceTracker.clearSession(),r.onTrigger({trigger:"start"})}),e.on("resume",function(){var e=i.default.DEFAULT_KEYS.MESSAGE_CACHE,t=c.default.getFromLocalStorage(e);r._messageCache=t?JSON.parse(t):r._messageCache,r.occurrenceTracker.load(),r.onTrigger({trigger:"resume"})}),e.on("track",function(e){r.onTrigger({trigger:"event",eventName:e.eventName,params:e.params||{}})}),e.on("advanceState",function(e){return r.onTrigger({trigger:"state",state:e.state,params:e.params||{}})}),e.on("setUserAttribute",function(e){return r.onTrigger({trigger:"userAttribute",attributes:e})})}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.on=function(e,t){this.handlers.push({eventName:e,callback:t})},s.prototype.off=function(e,t){this.handlers=this.handlers.filter(function(n){return n.eventName!==e||n.callback!==t})},s.prototype.emit=function(e,t){this.handlers.forEach(function(n){n.eventName===e&&n.callback(t)})},s);function s(){this.handlers=[]}t.default=r},function(e,t,n){"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ActionParameterType||(t.ActionParameterType={})).Integer="integer",r.Color="color",r.Float="float",r.Decimal="decimal",r.Number="number",r.Boolean="bool",r.String="string",r.Text="text",r.HTML="html",r.File="file",r.List="list",r.Group="group",r.Action="action",r.Unknown="",(s=t.MessageKind||(t.MessageKind={}))[s.Action=2]="Action",s[s.Template=3]="Template"},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),o=s(n(0)),a=s(n(2)),u=s(n(5)),c=(l.prototype.applyDiffs=function(e,t,n){var s;this.diffs=e,this.variants=t,this.actionDefinitions=r(r({},this.actionDefinitions),(s=n)?Object.keys(s).reduce(function(e,t){e[t]=r({},s[t]);var n=s[t].kinds;return n&&(e[t].kinds=Object.keys(n).reduce(function(r,s){var i=n[s].toLowerCase();return"action"===(r[s]=i)&&(e[t].values[s]=""),r},{})),e},{}):s),this.hasReceivedDiffs=!0,this.merged=function e(t,n){if("number"==typeof n||"boolean"==typeof n||"string"==typeof n)return n;if(null==n)return t;var r=function(e){return function(t){if(e instanceof Array)for(var n=0;n<e.length;n++)t(e[n]);else for(var r in e)!{}.hasOwnProperty.call(e,r)||t(r)}},s=r(t),i=r(n),o=!1;if(null===t&&!(n instanceof Array))for(var a in o=null,n)if(n.hasOwnProperty(a)){if(null===o&&(o=!0),"string"!=typeof a){o=!1;break}if(a.length<3||"["!==a.charAt(0)||"]"!==a.charAt(a.length-1)){o=!1;break}}if(t instanceof Array||o){var u=[];return s(function(e){u.push(e)}),i(function(t){for(var r=parseInt(t.substring(1,t.length-1)),s=n[t];r>=u.length;)u.push(null);u[r]=e(u[r],s)}),u}var c={};return s(function(e){null!==n[e]&&void 0!==n[e]||(c[e]=t[e])}),i(function(r){c[r]=e(null===t?null:t[r]||{},n[r])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},l.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.ACTION_DEFINITIONS)||null)),this.token=this.loadLocal(o.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(o.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},l.prototype.saveDiffs=function(){this.saveLocal(o.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(o.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(o.default.DEFAULT_KEYS.ACTION_DEFINITIONS,JSON.stringify(this.actionDefinitions||{})),this.saveLocal(o.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(o.default.DEFAULT_KEYS.TOKEN,this.token)},l.prototype.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getVariables();if(n)for(var r=0;r<e.length;r++)n=n[e[r]];return n},l.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},l.prototype.setVariables=function(e){this.variables=e},l.prototype.addVariablesChangedHandler=function(e){this.variablesChangedHandlers.push(e),this.hasReceivedDiffs&&e()},l.prototype.removeVariablesChangedHandler=function(e){var t=this.variablesChangedHandlers.indexOf(e);0<=t&&this.variablesChangedHandlers.splice(t,1)},l.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this.variablesChangedHandlers.length;e++)this.variablesChangedHandlers[e]()},l.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},l.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},l.prototype.sendActions=function(){var e;return!!Object.keys(this.actionDefinitions).length&&(this.setVars(((e={})[o.default.PARAMS.ACTION_DEFINITIONS]=this.actionDefinitions,e)),!0)},l.prototype.sendVariables=function(){var e;this.setVars(((e={})[o.default.PARAMS.VARIABLES]=this.variables,e))},l.prototype.setVars=function(e){var t=(new i.default).body(JSON.stringify(e));this.createRequest(o.default.METHODS.SET_VARS,t,{sendNow:!0})},l.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},l.prototype.registerActionDefinition=function(e){var t;this.actionDefinitions[e.name]={kind:(t=e).kind||3,options:null,values:function e(t){return t.reduce(function(t,n){return n.value instanceof Array?t[n.name]=e(n.value):"action"===n.type?t[n.name]="":"color"===n.type?t[n.name]=u.default.encodeColor(n.value):t[n.name]=n.value,t},{})}(t.args),kinds:function e(t,n){return void 0===n&&(n=""),t.reduce(function(t,s){var i,o=""+n+s.name;return s.value instanceof Array?t=r(((i={})[o]="group",i),e(s.value,o+".")):t[o]=s.type.toLowerCase(),t},{})}(t.args)}},l.prototype.loadLocal=function(e){return a.default.getFromLocalStorage(e)},l.prototype.saveLocal=function(e,t){a.default.saveToLocalStorage(e,t)},l);function l(e){this.createRequest=e,this.actionDefinitions={},this.hasReceivedDiffs=!1,this.merged=void 0,this.variables=null,this.variablesChangedHandlers=[],this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=c}],e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var s in t)e.d(r,s,function(e){return t[e]}.bind(null,s));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=6);function e(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var t,n}()}}]);